<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Searcher</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=2">
</head>

<body>
    <div id="app">
        <div class="controls" id="globalControls">
            <div style="display: flex; gap: 10px; align-items: center;">
                <a href="#/home" class="nav-link" id="navHome">Home</a>
                <a href="#/explore" class="nav-link" id="navExplore">Explore</a>
                <a href="#/all-movies" class="nav-link" id="navAllMovies">All Movies</a>
                <div class="playlists-nav-dropdown" id="playlistsNavDropdown">
                    <button class="nav-link playlists-nav-btn" id="navPlaylistsBtn"
                        onclick="togglePlaylistsDropdown()">Playlists ‚ñº</button>
                    <div class="playlists-dropdown-menu" id="playlistsDropdownMenu">
                        <a href="#/playlists" class="playlists-dropdown-item" onclick="closePlaylistsDropdown()">üìÇ
                            Manage Playlists</a>
                        <div class="playlists-dropdown-divider"></div>
                        <div id="quickPlaylistLinks">
                            <!-- Dynamic playlist links will be inserted here -->
                        </div>
                    </div>
                </div>
                <a href="#/history" class="nav-link" id="navHistory">History</a>
            </div>
            <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                <div id="statusMessage"></div>
                <div id="screenshotProcessorStatus" class="screenshot-processor-status"></div>
                <div id="currentlyPlaying" class="currently-playing">nothing playing</div>
                <a href="#/setup" class="nav-link" id="navSetup">Setup</a>
            </div>
        </div>

        <!-- Home Page -->
        <div class="page active" id="pageHome">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h1 style="margin: 0;">Movie Searcher</h1>
                <button type="button" class="btn" onclick="showRandomMovies()" style="margin-left: 16px;">Show 10 Random
                    Movies</button>
            </div>

            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search movies..." autocomplete="off">
                <div class="autocomplete" id="autocomplete"></div>
                <button class="clear-search-btn" id="clearSearchBtn" onclick="clearSearch()" style="display: none;">√ó
                    Clear</button>
            </div>

            <div class="filter-options">
                <div class="btn-group btn-group-toggle" role="group">
                    <button type="button" class="btn active" data-filter="all"
                        onclick="setWatchFilter('all', this)">All</button>
                    <button type="button" class="btn" data-filter="watched"
                        onclick="setWatchFilter('watched', this)">Watched only</button>
                    <button type="button" class="btn" data-filter="unwatched"
                        onclick="setWatchFilter('unwatched', this)">Unwatched only</button>
                </div>
                <!-- Language filter moved to Explore -->
            </div>

            <div id="aiSearchInline"
                style="margin-top: 20px; padding: 16px; background: #1d1d1d; border: 1px solid #333; border-radius: 6px;">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
                    <div style="font-weight: 600; color: #fff;">AI Search</div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap;">
                    <input type="text" id="aiSearchInput"
                        placeholder="Ask about movies (e.g. &quot;what were Kubrick's 10 most influential movies? and give me a quote and year it was said for each?&quot;)..."
                        style="flex: 1 1 300px; min-width: 220px; padding: 12px; font-size: 16px; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 4px;"
                        onkeypress="if(event.key === 'Enter') performAiSearch()">
                    <select id="aiProviderSelect"
                        style="padding: 0 15px; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 4px;">
                        <option value="anthropic" selected>Claude 4.5 Sonnet</option>
                        <option value="openai">GPT-5.1</option>
                    </select>
                    <button class="btn" id="aiSearchButton" onclick="performAiSearch()">Ask AI</button>
                </div>
                <div id="aiCostDisplay"
                    style="font-size: 0.9em; color: #888; min-height: 1.2em; margin-top: 6px; width: 100%; display: flex; justify-content: flex-end; text-align: right;"></div>
                <div id="aiSearchStatus" style="margin-top: 10px; color: #888; min-height: 1.2em;"></div>
            </div>

            <div class="results" id="results"></div>

            <div class="watched-section" id="watchedSection">
                <div class="section-title">Watched Movies</div>
                <button class="btn btn-secondary" id="viewWatchedBtn" onclick="toggleWatchedView()">View
                    Watched</button>
                <div id="watchedList"></div>
            </div>

            <div class="stats" id="stats"></div>
        </div>

        <!-- Explore Page -->
        <div class="page" id="pageExplore">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h1 style="margin: 0;">Explore Movies</h1>
                <button type="button" class="btn" onclick="goToRandomMovie()" style="margin-left: 16px;">Random
                    Movie</button>
            </div>

            <div class="explore-filters">
                <div class="btn-group btn-group-toggle" role="group">
                    <button type="button" class="btn active" data-filter="all"
                        onclick="setExploreWatchFilter('all', this)">All</button>
                    <button type="button" class="btn" data-filter="watched"
                        onclick="setExploreWatchFilter('watched', this)">Watched only</button>
                    <button type="button" class="btn" data-filter="unwatched"
                        onclick="setExploreWatchFilter('unwatched', this)">Unwatched only</button>
                    <button type="button" class="btn" data-filter="newest"
                        onclick="setExploreWatchFilter('newest', this)">Newest 100</button>
                </div>
                <div style="margin-left:16px;padding-left:16px;border-left: 2px solid #e0e0e0;">
                    <div class="btn-group btn-group-toggle language-filter-group" role="group"
                        id="exploreLanguageFilterGroup"
                        style="display:inline-flex;flex-wrap:wrap;gap:0;align-items:center;">
                        <!-- Audio language buttons will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="letter-nav" id="letterNav"></div>

            <div class="decade-nav" id="decadeNav"></div>

            <div class="year-filter-container" id="yearFilterContainer">
                <div class="year-input-wrapper">
                    <input type="text" id="yearInput" placeholder="Filter by year..." autocomplete="off"
                        class="year-input">
                    <div class="year-autocomplete" id="yearAutocomplete"></div>
                </div>
                <div class="year-chip-container" id="yearChipContainer"></div>
            </div>

            <div class="movie-grid" id="movieGrid"></div>

            <div class="pagination" id="explorePagination"></div>
        </div>

        <!-- Movie Details Page -->
        <div class="page" id="pageMovieDetails">
            <button class="back-button" onclick="historyBack()">‚Üê Back</button>
            <div class="movie-details-container" id="movieDetailsContainer">
                <div class="loading">Loading movie details...</div>
            </div>
        </div>

        <!-- All Movies Page -->
        <div class="page" id="pageAllMovies">
            <h1>All Movies</h1>
            <div id="allMoviesStats" style="margin-bottom: 20px; color: #999; font-size: 14px;"></div>
            <div id="allMoviesList" style="font-size: 14px; line-height: 1.8; color: #e0e0e0;">
                <div class="loading">Loading movies...</div>
            </div>
        </div>

        <!-- History Page -->
        <div class="page" id="pageHistory">
            <h1>Launch History</h1>
            <div id="historyList" class="history-list"></div>
        </div>

        <!-- Playlists Page -->
        <div class="page" id="pagePlaylists">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h1>My Playlists</h1>
                <button class="btn" onclick="showCreatePlaylistDialog()">Create Playlist</button>
            </div>

            <div class="playlists-overview" id="playlistsOverview">
                <div class="loading">Loading playlists...</div>
            </div>

            <div class="playlist-view" id="playlistView" style="display: none;">
                <div class="playlist-header">
                    <button class="btn btn-secondary" onclick="backToPlaylistsOverview()">&larr; Back to
                        Playlists</button>
                    <h2 id="playlistTitle"></h2>
                    <div class="playlist-actions">
                        <select id="playlistSortSelect" onchange="changePlaylistSort(this.value)">
                            <option value="date_added">Date Added</option>
                            <option value="name">Name</option>
                            <option value="year">Year</option>
                        </select>
                    </div>
                </div>
                <div class="movie-grid" id="playlistMovies"></div>
                <div class="pagination" id="playlistPagination"></div>
            </div>
        </div>

        <!-- Duplicates Page -->
        <div class="page" id="pageDuplicates">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h1>Duplicate Movies</h1>
                <button class="btn btn-secondary" onclick="window.location.hash='/setup'">Back to Setup</button>
            </div>
            <p style="margin-bottom: 20px; color: #999;">Identified movies with identical names. Hiding a movie removes
                it from search results but keeps the file on disk.</p>

            <div id="duplicateMoviesList">
                <div class="loading">Loading...</div>
            </div>
        </div>

        <!-- Setup Page -->
        <div class="page" id="pageSetup">
            <h1>Setup</h1>

            <div class="setup-section">
                <h3>Movies Folder</h3>
                <p>Configure the folder where your movies are stored. The application will scan this folder to index all
                    video files.</p>
                <div class="folder-info" style="margin-bottom: 15px;">
                    <span>Current folder:</span>
                    <span class="folder-path" id="setupCurrentFolder">Loading...</span>
                </div>
                <button class="btn" id="setupChangeFolderBtn" onclick="showFolderDialog()">Change Movies Folder</button>
            </div>

            <div class="setup-section">
                <h3>Scan Movies</h3>
                <p>Scan your movies folder to index all video files. This will update the database with any new or
                    changed files.</p>
                <button class="btn" id="setupScanBtn" onclick="scanFolder()">Scan Movies Folder</button>
                <div class="progress-container" id="setupProgressContainer" style="margin-top: 15px;">
                    <div class="progress-info">
                        <span id="setupProgressStatus">Preparing scan...</span>
                        <span id="setupProgressCount">0 / 0</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="setupProgressBar" style="width: 0%">0%</div>
                    </div>
                    <div class="progress-file" id="setupProgressFile"></div>
                    <div class="scan-log-window" id="setupScanLogWindow" style="display: none;"></div>
                </div>
            </div>

            <div class="setup-section">
                <h3>VLC Settings</h3>
                <p>Configure how VLC media player behaves when launching movies.</p>
                <div class="setup-option">
                    <label>
                        <input type="checkbox" id="setupCloseExistingVlc" checked>
                        Close existing VLC windows when launching a new movie
                    </label>
                    <div class="setup-option-description">
                        When enabled, all existing VLC windows will be closed before launching a new movie. When
                        disabled, new movies will open in addition to any existing VLC windows.
                    </div>
                </div>
                <div class="setup-option" style="margin-top: 15px;">
                    <label>
                        <input type="checkbox" id="setupLaunchWithSubtitlesOn" checked>
                        Launch with subtitles on
                    </label>
                    <div class="setup-option-description">
                        When enabled, automatically enable subtitles if a subtitle file is found in the same folder as
                        the movie. When disabled, movies will launch without subtitles unless manually selected.
                    </div>
                </div>
            </div>

            <div class="setup-section">
                <h3>Name Cleaning</h3>
                <p>Re-apply name cleaning rules to all movies in the database.</p>
                <button class="btn" onclick="recleanAllNames()">Re-clean All Movie Names</button>
                <div id="recleanStatus"
                    style="margin-top: 10px; padding: 10px; background: #2a2a2a; border-radius: 6px; display: none;">
                </div>
            </div>

            <div class="setup-section">
                <h3>Find Duplicate Movies</h3>
                <p>Find movies with identical names to help identify duplicates.</p>
                <a href="#/duplicates" class="btn" style="text-decoration: none;">Manage Duplicates</a>
            </div>

            <div class="setup-section">
                <h3>Hidden Movies</h3>
                <p>Manage movies you have hidden from search and explore.</p>
                <button class="btn" onclick="loadHiddenMovies()">View Hidden Movies</button>
                <div id="hiddenMoviesList" style="margin-top: 15px; display: none;"></div>
            </div>

            <div class="setup-section">
                <h3>Statistics</h3>
                <div id="setupStats"></div>
            </div>
        </div>

        <div class="folder-dialog" id="folderDialog">
            <h3>Select Movies Folder</h3>
            <p style="margin-bottom: 10px; color: #999; font-size: 13px;">Enter the full path to your movies folder:</p>
            <input type="text" id="folderPathInput" placeholder="C:\Movies or D:\Movies\MyCollection"
                style="margin-bottom: 15px;" autofocus>
            <p style="margin-bottom: 15px; color: #777; font-size: 12px;">You can use forward slashes (/) or backslashes
                (\) - they will be converted automatically.</p>
            <div class="dialog-buttons">
                <button class="btn btn-secondary" onclick="hideFolderDialog()">Cancel</button>
                <button class="btn btn-success" onclick="saveFolderPath()">Save</button>
            </div>
        </div>

        <div class="media-overlay" id="mediaOverlay" onclick="closeMediaOverlay()">
            <div class="media-overlay-close" onclick="event.stopPropagation(); closeMediaOverlay();">√ó</div>
            <img id="mediaOverlayImage" onclick="event.stopPropagation();" alt="Full size image">
        </div>

        <div id="screenshotConfigDialog"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
            <div style="background: #2a2a2a; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%;">
                <h2 style="color: #fff; margin-top: 0;">Screenshot Configuration</h2>
                <input type="hidden" id="screenshotConfigMovieId">
                <div style="margin-bottom: 20px;">
                    <label style="color: #fff; display: block; margin-bottom: 8px;">Interval (minutes):</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button onclick="setScreenshotInterval(0.33)" class="btn btn-secondary btn-small" style="flex: 1;">20s</button>
                        <button onclick="setScreenshotInterval(1)" class="btn btn-secondary btn-small" style="flex: 1;">1m</button>
                        <button onclick="setScreenshotInterval(2)" class="btn btn-secondary btn-small" style="flex: 1;">2m</button>
                        <button onclick="setScreenshotInterval(3)" class="btn btn-secondary btn-small" style="flex: 1;">3m</button>
                        <button onclick="setScreenshotInterval(5)" class="btn btn-secondary btn-small" style="flex: 1;">5m</button>
                    </div>
                    <input type="number" id="screenshotConfigInterval" value="3" min="0.1" max="60" step="0.1"
                        style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #3a3a3a; color: #fff; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="color: #fff; display: block; margin-bottom: 8px;">Subtitle file (optional):</label>
                    <select id="screenshotConfigSubtitle"
                        style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #3a3a3a; color: #fff; border-radius: 4px;">
                        <option value="">No subtitle</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="closeScreenshotConfig()"
                        style="background: #3a3a3a; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Cancel</button>
                    <button onclick="generateScreenshots()"
                        style="background: #4a9eff; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Generate</button>
                </div>
            </div>
        </div>

        <script src="/js/utils.js?v=2"></script>
        <script src="/js/routing.js?v=2"></script>
        <script src="/js/components.js?v=2"></script>
        <script src="/js/search.js?v=2"></script>
        <script src="/js/explore.js?v=2"></script>
        <script src="/js/all-movies.js?v=2"></script>
        <script src="/js/movie-details.js?v=2"></script>
        <script src="/js/playlists.js?v=2"></script>
        <script src="/js/media.js?v=2"></script>
        <script src="/js/history.js?v=2"></script>
        <script src="/js/setup.js?v=2"></script>
        <script src="/js/ai-search.js?v=2"></script>
        <script src="/js/app.js?v=2"></script>
</body>

</html>